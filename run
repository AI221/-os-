pcall(function()
  local newshell=loadfile("library/executable")
  local env={}
  --setmetatable(env,{__index=_G})
  local ok,err
  if type(newshell)=="function" then 
    env=getfenv()
    setfenv(newshell,env)
    ok,err=pcall(newshell)
  else 
    ok,err = false,newshell 
  end
  term.clearLine()
  term.setTextColor(colors.white)
  term.setBackgroundColor(colors.blue)
  term.clear()
  term.setBackgroundColor(colors.white)
  term.setTextColor(colors.blue)
  term.setCursorPos(1,5)

  local function cWrite(text)
    if type(text)=="string" then
      local _,y=term.getCursorPos()
      term.setCursorPos((term.getSize()-#text)/2,y)
      write(text)
    end
  end
  function cPrint(text)
    cWrite(text)
    local _,y=term.getCursorPos()
    term.setCursorPos(1,y+1)
  end
  cPrint"A FATAL ERROR OCCURED"
  print()
  term.setBackgroundColor(colors.blue)
  term.setTextColor(colors.white)
  print()
  cPrint"One or more issues have caused Newshell to crash."
  cPrint"Your session cannot be resumed and all"
  cPrint"Any globals CAN be retrieved"
  cPrint"I apologize for the inconvience."
  print()print()print()
  cPrint"Press R to restart or C to launch CraftOS"
  local _,y=term.getSize()
  term.setCursorPos(1,y-2)
  cPrint"Error:"
  cWrite(err)
  term.setCursorBlink(true)
  while true do
    local _,butto=os.pullEvent"char"
    butto=string.lower(butto)
    if butto == "r" then
      os.reboot()
    elseif butto == "c" then
      os.run({},"rom/programs/shell")
      print"CraftOS broke... You are not very lucky."
      print"R to restart, C to relaunch."
    end  
  end
end 
)
pcall(function() print" run has crashed. running shell." end)
os.run({},'rom/programs/shell')
